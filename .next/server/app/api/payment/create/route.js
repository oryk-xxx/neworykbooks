"use strict";(()=>{var e={};e.id=70,e.ids=[70],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9567:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>A,patchFetch:()=>E,requestAsyncStorage:()=>d,routeModule:()=>_,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var r={};o.r(r),o.d(r,{POST:()=>u});var a=o(9303),s=o(8716),n=o(670),i=o(7070),c=o(7848),p=o(748);async function u(){let e=(0,p.j)(),{data:{user:t}}=await e.auth.getUser();if(!t)return i.NextResponse.json({error:"unauthorized"},{status:401});if(!c.O.mercadoPagoAccessToken)return i.NextResponse.json({error:"Mercado Pago access token n\xe3o configurado"},{status:500});let o={transaction_amount:c.O.paymentAmount,description:"Acesso vital\xedcio \xd8RYK Books",payment_method_id:"pix",payer:{email:t.email||"user@example.com",first_name:t.user_metadata?.name||"Usu\xe1rio"},...c.O.siteUrl&&!c.O.siteUrl.includes("localhost")?{notification_url:`${c.O.siteUrl}/api/payment/webhook`}:{}},r=await fetch("https://api.mercadopago.com/v1/payments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.O.mercadoPagoAccessToken}`,"X-Idempotency-Key":`${t.id}-${Date.now()}`},body:JSON.stringify(o)});if(!r.ok){let e=await r.text();return console.error("MERCADO PAGO API ERROR:",e),i.NextResponse.json({error:"Falha Mercado Pago",details:e},{status:500})}let a=await r.json(),s=(0,p.i)();await s.from("entitlements").upsert({user_id:t.id,active:!1,last_payment_id:String(a.id)}).select("*").maybeSingle();let n=a?.point_of_interaction?.transaction_data?.qr_code,u=a?.point_of_interaction?.transaction_data?.qr_code_base64;return i.NextResponse.json({id:String(a.id),status:a.status,qr_code:n,qr_code_base64:u})}let _=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/payment/create/route",pathname:"/api/payment/create",filename:"route",bundlePath:"app/api/payment/create/route"},resolvedPagePath:"/home/oryk/Documentos/GitHub/neworykbooks/src/app/api/payment/create/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:m}=_,A="/api/payment/create/route";function E(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}},7848:(e,t,o)=>{o.d(t,{O:()=>r});let r={siteUrl:process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000",supabaseUrl:process.env.NEXT_PUBLIC_SUPABASE_URL||"",supabaseAnonKey:process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",supabaseServiceRoleKey:process.env.SUPABASE_SERVICE_ROLE_KEY||"",mercadoPagoAccessToken:process.env.MERCADOPAGO_ACCESS_TOKEN||"",mercadoPagoWebhookSecret:process.env.MERCADOPAGO_WEBHOOK_SECRET||"",paymentAmount:Number(process.env.NEXT_PUBLIC_PAYMENT_AMOUNT||.8),originalAmount:Number(process.env.NEXT_PUBLIC_PAYMENT_ORIGINAL_AMOUNT||19)}},748:(e,t,o)=>{o.d(t,{i:()=>i,j:()=>n});var r=o(7721),a=o(1615),s=o(7857);function n(){let e=(0,a.cookies)();return(0,r.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,o,r){try{e.set({name:t,value:o,...r})}catch(e){}},remove(t,o){try{e.set({name:t,value:"",...o})}catch(e){}}},auth:{flowType:"pkce"}})}function i(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("SUPABASE_SERVICE_ROLE_KEY ou URL n\xe3o configurados.");return(0,s.eI)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[276,786,702,972],()=>o(9567));module.exports=r})();