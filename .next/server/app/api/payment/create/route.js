"use strict";(()=>{var e={};e.id=70,e.ids=[70],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},451:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>S,requestAsyncStorage:()=>_,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var o={};r.r(o),r.d(o,{POST:()=>u});var a=r(9303),s=r(8716),n=r(670),i=r(7070),c=r(7848),p=r(748);async function u(){let e=(0,p.Lg)(),{data:{session:t}}=await e.auth.getSession();if(!t)return i.NextResponse.json({error:"unauthorized"},{status:401});if(!c.O.mercadoPagoAccessToken)return i.NextResponse.json({error:"Mercado Pago access token n\xe3o configurado"},{status:500});let r={transaction_amount:7,description:"Acesso vital\xedcio \xd8RYK Books",payment_method_id:"pix",payer:{email:t.user.email||"user@example.com",first_name:t.user.user_metadata?.name||"Usu\xe1rio"},notification_url:`${c.O.siteUrl}/api/payment/webhook`},o=await fetch("https://api.mercadopago.com/v1/payments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.O.mercadoPagoAccessToken}`},body:JSON.stringify(r)});if(!o.ok){let e=await o.text();return i.NextResponse.json({error:"Falha Mercado Pago",details:e},{status:500})}let a=await o.json();await e.from("entitlements").upsert({user_id:t.user.id,active:!1,last_payment_id:String(a.id)}).select("*").maybeSingle();let s=a?.point_of_interaction?.transaction_data?.qr_code,n=a?.point_of_interaction?.transaction_data?.qr_code_base64;return i.NextResponse.json({id:String(a.id),status:a.status,qr_code:s,qr_code_base64:n})}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/payment/create/route",pathname:"/api/payment/create",filename:"route",bundlePath:"app/api/payment/create/route"},resolvedPagePath:"C:\\Users\\kirit\\Documents\\GitHub\\neworykbooks\\src\\app\\api\\payment\\create\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:_,staticGenerationAsyncStorage:l,serverHooks:m}=d,E="/api/payment/create/route";function S(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}},7848:(e,t,r)=>{r.d(t,{O:()=>o});let o={siteUrl:process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000",supabaseUrl:process.env.NEXT_PUBLIC_SUPABASE_URL||"",supabaseAnonKey:process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",supabaseServiceRoleKey:process.env.SUPABASE_SERVICE_ROLE_KEY||"",mercadoPagoAccessToken:process.env.MERCADOPAGO_ACCESS_TOKEN||"",mercadoPagoWebhookSecret:process.env.MERCADOPAGO_WEBHOOK_SECRET||""}},748:(e,t,r)=>{r.d(t,{JJ:()=>i,Lg:()=>n,i_:()=>c});var o=r(1615),a=r(344),s=r(7857);function n(){return(0,a.createRouteHandlerClient)({cookies:o.cookies})}function i(){return(0,a.createServerComponentClient)({cookies:o.cookies})}function c(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("SUPABASE_SERVICE_ROLE_KEY ou URL n\xe3o configurados.");return(0,s.eI)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,998,972],()=>r(451));module.exports=o})();