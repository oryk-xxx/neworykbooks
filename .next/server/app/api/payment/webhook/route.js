"use strict";(()=>{var e={};e.id=958,e.ids=[958],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6987:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>E,patchFetch:()=>A,requestAsyncStorage:()=>d,routeModule:()=>_,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var r={};o.r(r),o.d(r,{POST:()=>u});var s=o(9303),a=o(8716),n=o(670),i=o(7070),p=o(7848),c=o(748);async function u(e){let t=await e.json().catch(()=>null),o=new URL(e.url).searchParams.get("type")||t?.type||"",r=t?.data?.id||t?.id;if(!r)return i.NextResponse.json({ok:!0});let s=await fetch(`https://api.mercadopago.com/v1/payments/${r}`,{headers:{Authorization:`Bearer ${p.O.mercadoPagoAccessToken}`}});if(!s.ok)return i.NextResponse.json({ok:!1},{status:500});let a=await s.json(),n=a.status,u=(0,c.i)(),{data:_}=await u.from("entitlements").select("*").eq("last_payment_id",String(a.id)).maybeSingle();return _&&await u.from("entitlements").update({active:"approved"===n,updated_at:new Date().toISOString(),last_payment_id:String(a.id)}).eq("user_id",_.user_id),await u.from("logs").insert({action:`payment_webhook:${o}:${n}`,user_id:_?.user_id||null,ip:"",user_agent:""}),i.NextResponse.json({ok:!0})}let _=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/payment/webhook/route",pathname:"/api/payment/webhook",filename:"route",bundlePath:"app/api/payment/webhook/route"},resolvedPagePath:"/home/oryk/Documentos/GitHub/neworykbooks/src/app/api/payment/webhook/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:m}=_,E="/api/payment/webhook/route";function A(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}},7848:(e,t,o)=>{o.d(t,{O:()=>r});let r={siteUrl:process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000",supabaseUrl:process.env.NEXT_PUBLIC_SUPABASE_URL||"",supabaseAnonKey:process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",supabaseServiceRoleKey:process.env.SUPABASE_SERVICE_ROLE_KEY||"",mercadoPagoAccessToken:process.env.MERCADOPAGO_ACCESS_TOKEN||"",mercadoPagoWebhookSecret:process.env.MERCADOPAGO_WEBHOOK_SECRET||"",paymentAmount:Number(process.env.NEXT_PUBLIC_PAYMENT_AMOUNT||.8),originalAmount:Number(process.env.NEXT_PUBLIC_PAYMENT_ORIGINAL_AMOUNT||19)}},748:(e,t,o)=>{o.d(t,{i:()=>i,j:()=>n});var r=o(7721),s=o(1615),a=o(7857);function n(){let e=(0,s.cookies)();return(0,r.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,o,r){try{e.set({name:t,value:o,...r})}catch(e){}},remove(t,o){try{e.set({name:t,value:"",...o})}catch(e){}}},auth:{flowType:"pkce"}})}function i(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("SUPABASE_SERVICE_ROLE_KEY ou URL n\xe3o configurados.");return(0,a.eI)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[276,786,702,972],()=>o(6987));module.exports=r})();