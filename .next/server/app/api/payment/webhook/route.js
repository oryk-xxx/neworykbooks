"use strict";(()=>{var e={};e.id=958,e.ids=[958],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},7796:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>E,patchFetch:()=>S,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>_});var r={};o.r(r),o.d(r,{POST:()=>c});var s=o(9303),n=o(8716),a=o(670),i=o(7070),p=o(7848),u=o(748);async function c(e){let t=await e.json().catch(()=>null),o=new URL(e.url).searchParams.get("type")||t?.type||"",r=t?.data?.id||t?.id;if(!r)return i.NextResponse.json({ok:!0});let s=await fetch(`https://api.mercadopago.com/v1/payments/${r}`,{headers:{Authorization:`Bearer ${p.O.mercadoPagoAccessToken}`}});if(!s.ok)return i.NextResponse.json({ok:!1},{status:500});let n=await s.json(),a=n.status,c=(0,u.i_)(),{data:d}=await c.from("entitlements").select("*").eq("last_payment_id",String(n.id)).maybeSingle();return d&&await c.from("entitlements").update({active:"approved"===a,updated_at:new Date().toISOString(),last_payment_id:String(n.id)}).eq("user_id",d.user_id),await c.from("logs").insert({action:`payment_webhook:${o}:${a}`,user_id:d?.user_id||null,ip:"",user_agent:""}),i.NextResponse.json({ok:!0})}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/payment/webhook/route",pathname:"/api/payment/webhook",filename:"route",bundlePath:"app/api/payment/webhook/route"},resolvedPagePath:"C:\\Users\\kirit\\Documents\\GitHub\\neworykbooks\\src\\app\\api\\payment\\webhook\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:_,serverHooks:m}=d,E="/api/payment/webhook/route";function S(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:_})}},7848:(e,t,o)=>{o.d(t,{O:()=>r});let r={siteUrl:process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000",supabaseUrl:process.env.NEXT_PUBLIC_SUPABASE_URL||"",supabaseAnonKey:process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",supabaseServiceRoleKey:process.env.SUPABASE_SERVICE_ROLE_KEY||"",mercadoPagoAccessToken:process.env.MERCADOPAGO_ACCESS_TOKEN||"",mercadoPagoWebhookSecret:process.env.MERCADOPAGO_WEBHOOK_SECRET||""}},748:(e,t,o)=>{o.d(t,{JJ:()=>i,Lg:()=>a,i_:()=>p});var r=o(1615),s=o(344),n=o(7857);function a(){return(0,s.createRouteHandlerClient)({cookies:r.cookies})}function i(){return(0,s.createServerComponentClient)({cookies:r.cookies})}function p(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("SUPABASE_SERVICE_ROLE_KEY ou URL n\xe3o configurados.");return(0,n.eI)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[276,998,972],()=>o(7796));module.exports=r})();